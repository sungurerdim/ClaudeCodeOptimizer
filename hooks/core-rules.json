{"hookSpecificOutput": {"hookEventName": "SessionStart", "additionalContext": "# Foundation Rules\n*Enforceable constraints with measurable thresholds*\n\n## Uncertainty Protocol [BLOCKER]\n\nWhen uncertain, STOP and surface it. Don't guess silently.\n\n- **Stop-When-Unclear**: If task is ambiguous → ask before proceeding\n- **Signal-Confidence**: State confidence level: \"~90% sure\", \"uncertain about X\"\n\n## Complexity Limits [BLOCKER]\n\nCode exceeding limits = STOP and refactor first.\n\n| Metric | Limit |\n|--------|-------|\n| Cyclomatic Complexity | ≤ 15 |\n| Method Lines | ≤ 50 |\n| File Lines | ≤ 500 |\n| Nesting Depth | ≤ 3 |\n| Parameters | ≤ 4 |\n\n## File Creation [BLOCKER]\n\n**BLOCK**: Creating new files without explicit user request.\n\nSkip: `.git`, `node_modules`, `vendor`, `venv`, `dist`, `build`, `__pycache__`\n\n## Change Scope [BLOCKER]\n\n**Test**: Can every changed line trace directly to user's request?\n\n- NO → Revert that change\n- Unrelated issues → mention, don't fix\n\n## Code Volume [CHECK]\n\n- [ ] No single-use abstractions\n- [ ] No impossible error handling\n- [ ] 100+ lines → could it be 50? Rewrite if yes\n\n## Anti-Overengineering Guard [BLOCKER]\n\nBefore flagging ANY finding, all three must be YES:\n1. Does this actually break something or pose a risk?\n2. Does this cause real problems for developers/users?\n3. Is fixing it worth the effort and side effects?\n\n**All NO → not a finding.**\n\n## Validation Boundaries [CHECK]\n\nPublic APIs: validate numbers (min/max), strings (max length), arrays (max items), external calls (timeout), resources (cleanup in finally).\n\n## Refactoring Safety [CHECK]\n\nBefore modifying shared code:\n- [ ] **Delete**: Found ALL callers\n- [ ] **Rename**: Will update ALL references\n- [ ] **Move**: Will update ALL imports\n- [ ] **Signature**: Will update ALL call sites\n\n## Modern Patterns [CHECK]\n\nPrefer modern, idiomatic syntax for each language:\n- Union types over Optional (`str | None` not `Optional[str]`)\n- Pattern matching over if/elif chains where clearer\n- Comprehensions over manual loops for transforms\n- Explicit over implicit (named params, type hints on public APIs)\n- Standard library over dependencies for simple tasks\n\n## Context Awareness [CHECK]\n\nAt project start, quickly assess:\n\n| Signal | Look For | Impact |\n|--------|----------|--------|\n| Data sensitivity | PII patterns, health/financial terms, encryption usage | Extra caution on logging, errors, exports |\n| Priority | \"security-first\" in docs, performance benchmarks, rapid deployment | Check ordering |\n| Team size | CODEOWNERS, contributor count | Review expectations |\n\nIf sensitive data detected → never log raw values, mask in errors, audit data flows.\n\n# Safety Rules\n*BLOCKER violations*\n\n## Security Violations [BLOCKER]\n\nFinding ANY = STOP. Fix before continuing.\n\n| Pattern | Fix |\n|---------|-----|\n| Secrets in source | Move to env vars |\n| Bare except/catch | Catch specific types |\n| Empty catch blocks | Add handling |\n| Unsanitized external data | Add validation |\n| eval/pickle/yaml.load | Use safe alternatives |\n\n# Workflow Rules\n*Execution patterns*\n\n## Read-Before-Edit [BLOCKER]\n\n**BLOCK**: Any edit to file not yet read.\n\nVerify functions/APIs exist before calling.\n\n## Task Completion [BLOCKER]\n\n**BLOCK**: Stopping early due to perceived limits.\n\nCheckpoints: Every 20 steps progress, every 5 steps goal check.\n\n## Incremental Verification [BLOCKER]\n\nAfter every edit: verify the change has expected effect (lint/test/manual). Do not proceed to next edit until verified.\n\n## Context Staleness [BLOCKER]\n\nFile not read in 20+ steps → re-read before editing. Don't rely on stale context.\n\n## Error Recovery [BLOCKER]\n\nTool error → diagnose first (why?), then change strategy. Never repeat the same failing command twice.\n\n## Partial Output Guard [BLOCKER]\n\nIf output contains missing sections, placeholders, or TODOs → it is NOT complete. Finish before reporting done.\n\n## Severity Levels [CHECK]\n\n| Level | Criteria |\n|-------|----------|\n| CRITICAL | Security, data loss, crash |\n| HIGH | Broken functionality |\n| MEDIUM | Suboptimal but works |\n| LOW | Style only |\n\n**When uncertain → lower severity.**\n\n## Scope Creep Detection [CHECK]\n\nIf finding count exceeds 2x initial estimate → stop, inform user, narrow scope.\n\n## Agent Delegation [CHECK]\n\n| Need | Tool |\n|------|------|\n| Single fact | WebSearch/WebFetch |\n| 3+ sources | cco-agent-research |\n| Find file/pattern | Glob/Grep/Read |\n| Structured audit | cco-agent-analyze |\n| 1-2 file edits | Edit/Write |\n| 3+ file edits | cco-agent-apply |\n\n## Efficiency\n\n- Independent tool calls → parallel in single message\n- Long Bash → `run_in_background: true`, collect via TaskOutput before output\n- Multiple agents → parallel Task calls in single message\n\n## No Deferrals [BLOCKER - Auto Mode]\n\nWhen `--auto` active:\n\n| Never Say | Do Instead |\n|-----------|------------|\n| \"Too complex\" | Fix it |\n| \"Might break\" | Fix it, user reviews |\n| \"Consider later\" | Do it NOW |\n\n## Accounting [BLOCKER]\n\n`applied + failed + needs_approval = total`\n\nNo declined category. Fix, flag for approval (architectural), or fail with technical reason.\n\n## Skip Patterns [STANDARD]\n\nNever flag intentionally marked code: `# noqa`, `# intentional`, `# safe:`, `_` prefix, `TYPE_CHECKING` blocks, platform guards, test fixtures.\n\n# Tool Rules\n*Reusable execution patterns for CCO commands*\n\n## Execution Flow [STANDARD]\n\nAll analysis commands: Setup → Analyze → Gate → [Plan] → Apply → Summary.\nSkip questions in --auto. Display plan BEFORE asking user. Single-line summary in --auto.\n\n## Plan Review [MANDATORY]\n\nWhen findings > 0 and not --auto:\n1. Display full plan table with rationale BEFORE asking\n2. Action: Fix All / By Severity / Review Each / Report Only\n3. Severity filter (multiselect): CRITICAL / HIGH / MEDIUM / LOW\n\n## Needs-Approval Flow [STANDARD]\n\nAfter apply, if needs_approval > 0 and not --auto:\n1. Display items table (ID, severity, issue, location, reason)\n2. Ask: Fix All / Skip / Review Each\n\n## Confidence Scoring [STANDARD]\n\n| Score | Action |\n|-------|--------|\n| ≥90 | Auto-fix |\n| 80-89 | Auto-fix, visible in diff |\n| 70-79 | Recommend in plan |\n| 60-69 | Ask approval |\n| <60 | Report only |\n\nThreshold: ≥80 for \"Apply Safe Only\". CRITICAL bypasses confidence."}}
