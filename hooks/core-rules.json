{"hookSpecificOutput": {"hookEventName": "SessionStart", "additionalContext": "# Foundation Rules\n*Constraints and thresholds for code quality - not principles Opus already knows*\n\n## Decision Guard\n\nBefore adding code/feature, ask:\n1. Does absence break something?\n2. Does absence confuse users?\n3. Is adding worth complexity cost?\n\n**All NO = don't add.**\n\n## Complexity Thresholds [CRITICAL]\n\n| Metric | Good | Review | Refactor |\n|--------|------|--------|----------|\n| Cyclomatic Complexity | 1-10 | 11-15 | 16+ |\n| Cognitive Complexity | < 15 | 15-20 | 21+ |\n| Method Lines | < 50 | 50-100 | 100+ |\n| File Lines | < 500 | 500-1000 | 1000+ |\n| Nesting Depth | ≤ 3 | 4 | 5+ |\n| Parameters | ≤ 4 | 5-7 | 8+ |\n\n## File Handling [CRITICAL]\n\n- **Minimal-Touch**: Only files required for task\n- **Request-First**: Create files only when explicitly requested\n- **Skip**: `.git`, `node_modules`, `vendor`, `venv`, `dist`, `out`, `target`, `.idea`, `.vscode`, `*.min.*`, `@generated`\n\n## Validation Boundaries [CRITICAL]\n\nAll public APIs MUST validate input:\n- **Range-Bounds**: Numeric inputs need min/max limits\n- **String-Length**: String inputs need max length\n- **Collection-Size**: Arrays need max items limit\n- **Timeout-Required**: ALL external calls need explicit timeout\n- **Close-Always**: Resources closed in finally/with/using\n\n## Refactoring Safety\n\nBefore modifying:\n- **Delete**: Identify ALL callers before removing\n- **Rename**: Find refs → update ALL → verify builds\n- **Move**: Update all import statements\n- **Signature-Change**: Update all call sites\n\n## Output Format [CRITICAL]\n\n- **Step-Progress**: \"Step 2/5: Building...\"\n- **Summary-Final**: \"Changed 3 files, added 2 tests\"\n- **Impact-Explain**: \"This reduces bundle size by 15%\"\n- **Error-Actionable**: `[SEVERITY] {What} in {file}:{line}`\n\n## Team Scale\n\n| Team Size | Applies |\n|-----------|----------|\n| < 6 | Informal review OK |\n| 6+ | CODEOWNERS, branch protection required |\n\n# Safety Rules\n*Non-negotiable standards - violations = CRITICAL severity*\n\n## Non-Negotiable Standards [CRITICAL]\n\n| # | Violation | Required Action |\n|---|-----------|----------|\n| 1 | Error without logging AND user feedback | Add logging + user message |\n| 2 | `except:` or `catch (e)` without specific types | Catch specific exceptions |\n| 3 | Fallback without explicit justification | Document or remove |\n| 4 | API keys, passwords, tokens in source | Move to env vars/vault |\n| 5 | External data used without sanitization | Add input validation |\n| 6 | Empty catch/except blocks | Add handling or propagate |\n| 7 | Test doubles in non-test code | Remove or guard with test flag |\n\n**Finding any = CRITICAL severity, confidence 100, must fix before proceeding.**\n\n## Enforcement [CRITICAL]\n\n- **Block-On-Violation**: Security violation = STOP. Fix before continuing\n- **Fix-Immediately**: Violation detected = stop, fix, re-verify\n- **Full-Compliance**: 100% required, not \"mostly compliant\"\n\n## Specific Security Values\n\n| What | Safe | Unsafe |\n|------|------|--------|\n| Deserialize | `json.loads()` | `pickle.load()`, `yaml.load()`, `eval()` |\n| Passwords | bcrypt, argon2, scrypt | MD5, SHA1, plaintext |\n| Transit | TLS 1.2+ | HTTP, TLS 1.0/1.1 |\n| Rest | AES-256-GCM | DES, 3DES, ECB mode |\n\n## SSRF Prevention\n\nBlock internal IPs: `10.x`, `172.16.x`, `192.168.x`, `127.x`, `169.254.x`, `::1`, `fc00::`\n\n# Workflow Rules\n*CCO-specific execution patterns and enforcement*\n\n## Read-Before-Edit [CRITICAL]\n\n- **Investigation-Block**: BLOCK any edit until target file has been read. No read = no edit\n- **Verify-Existence**: Verify APIs, methods, parameters exist before use\n\n## Task Completion [CRITICAL]\n\n- **Complete-Tasks**: Never stop early due to perceived context limits - continue until done\n- **No-Self-Limiting**: If task requires 50 files, process all 50 files\n- **Checkpoint**: For tasks >20 steps, provide progress summaries but continue\n- **Continuation-Format**: \"Task incomplete, {n} items remaining\"\n\n## Agent Delegation [CRITICAL]\n\n```\nNeed information?\n├── Single URL/fact → WebSearch/WebFetch\n└── 3+ sources, CVE, comparison → cco-agent-research\n\nNeed analysis?\n├── Find file/pattern → Glob/Grep/Read\n└── Structured scan, metrics, audit → cco-agent-analyze\n\nNeed changes?\n├── Single file edit → Edit/Write\n└── 3+ files, verification needed → cco-agent-apply\n```\n\n## Severity Criteria [CRITICAL]\n\n| Severity | Criteria | Examples |\n|----------|----------|----------|\n| CRITICAL | Security breach, data loss, crash | SQL injection, secrets exposed |\n| HIGH | Broken functionality, principle violation | Missing validation, API mismatch |\n| MEDIUM | Suboptimal but functional | Code smell, missing edge case |\n| LOW | Style, cosmetic | Formatting, minor refactor |\n\n**When uncertain → choose lower severity.**\n\n## Reasoning Framework\n\n### Step-Back (Complex Tasks)\n\n| Task | Ask First |\n|------|----------|\n| Refactoring | \"What is the architectural pattern here?\" |\n| Bug fix | \"What is the expected behavior?\" |\n| Security audit | \"What are the trust boundaries?\" |\n| Performance | \"What are the critical paths?\" |\n\n### Chain of Thought (CRITICAL-HIGH)\n\n1. Identify: What exactly is the issue?\n2. Impact: Who/what is affected?\n3. Evidence: What confirms this?\n4. Severity: Based on evidence, what level?\n\n## Efficiency Patterns\n\n- **Parallel-Tool-Batching**: Independent tool calls in single message\n- **Speculative-Search**: Multiple parallel searches vs sequential refinement\n- **Background-Long**: Long commands → `run_in_background: true`\n\n## Output Standards [CRITICAL]\n\n### Severity Display\n\n| Internal | Display |\n|----------|----------|\n| P0 | CRITICAL |\n| P1 | HIGH |\n| P2 | MEDIUM |\n| P3 | LOW |\n\n### Status Values\n\n| Value | Threshold |\n|-------|----------|\n| OK | Score ≥ 80 |\n| WARN | Score 60-79 |\n| FAIL | Score 40-59 |\n| CRITICAL | Score < 40 |\n\n### Accounting Invariant\n\n`applied + failed = total`\n\nAI has no option to decline - only APPLIED or FAILED (with technical reason).\n\n## No Deferrals Policy (Auto/Fix-All) [CRITICAL]\n\n**When `--auto` or `--fix-all` active:**\n\nAI MUST attempt every fix. User decides what to skip, not AI.\n\n### Forbidden Skip Reasons\n\n| Never Say | Do Instead |\n|-----------|----------|\n| \"This is too complex\" | Fix it |\n| \"This requires refactoring\" | Do the refactor |\n| \"This is minor/trivial\" | Fix it anyway |\n| \"Recommend manual review\" | Apply the fix |\n| \"This might break something\" | Fix it, user reviews with git diff |\n| \"Consider doing this later\" | Do it NOW |\n\n### Valid Failure Reasons (Technical Only)\n\n- File not found\n- Parse error\n- Circular dependency\n- Permission denied\n- Binary file\n\n### Enforcement\n\n```javascript\nfor (const finding of allFindings) {\n  try {\n    applyFix(finding)\n    accounting.applied++\n  } catch (technicalError) {\n    accounting.failed++\n    // reason MUST be technical\n  }\n}\nassert(applied + failed === total)\n```\n\n## Format Standards\n\n- **Error**: `[SEVERITY] {What} in {file}:{line}`\n- **Placeholder**: `{variable}`, `{opt1|opt2}`, `{n}`"}}